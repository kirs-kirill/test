Изменение технологии связи на антенне
=====================================

.. warning:: Все изменения в конфигурации вносить только с запущенным скриптом RestoreAfterReload

Общая схема такова:

.. note:: Для антенн с модемом R11e-LTE это не применимо, там режим меняется галочками в lte-интерфейсе

.. mermaid::

    flowchart TD
        A["Проверить существует ли
            запись в modem init
            на интерфейсе ppp-out1 или lte1"]
        script["Запустить скрипт
            RestoreAfterReload"]
        modeminit["Прописать в modem init
            на интерфейсе ppp-out1 или lte1
            нужное значение
            Нажать OK, дождаться,
            пока антенна снова поднимется
            и снова запустить скрипт"]
        change["Установить нужный режим, нажать ОК
            дождаться восстановления антенны"]
        ending["После завершения работ
            удалить скрипт RestoreAfterReload
            из планировщика
            System - Scheduler"]

        script --> A
        A -->|Ничего нет| modeminit
        A -->|Что-то есть|change
        modeminit --> change --> ending

Схема применяется для большинства антенн с небольшими различиями в modeminit, о них ниже.

USB-модем
---------

При подключении к сети через usb-modem на антенне появляется интерфейс ``ppp-out1``.

В modeminit должна быть запись формата ``AT^SYSCFGEX="00",3fffffff,2,4,7fffffffffffffff,,``

Где 00 обозначает технологию:

* ``00`` - Auto
* ``03`` - LTE
* ``02`` - 3G
* ``01`` - GSM

Режимы можно комбинировать, например ``AT^SYSCFGEX="0203",3fffffff,2,4,7fffffffffffffff,,`` будет означать возможность подключения в LTE и 3G, но 3G будет в приоритете.


Simcom_7600
-----------

В интерфейсе ``lte1`` в modeminit должна быть запись формата ``AT+CNMP=2``, где 2 обозначает технологию:

* ``AT+CNMP=2`` - Auto
* ``AT+CNMP=13`` - 2G
* ``AT+CNMP=14`` - 3G
* ``AT+CNMP=38`` - 4G

Quectel
-------

В интерфейсе ``lte1`` в modeminit должна быть запись формата ``AT+QCFG="nwscanmode",00``, где 00 обозначает технологию:

* ``AT+QCFG="nwscanmode",00`` - Auto
* ``AT+QCFG="nwscanmode",03`` - 4G
* ``AT+QCFG="nwscanmode",02`` - 3G



Fibocom 850/860
-----------

В интерфейсе ``lte1`` или ``ppp-out1`` в modeminit должна быть запись формата ``AT+XACT=4``:

* ``AT+XACT=4`` - Auto
* ``AT+XACT=1,,,0`` - 3G
* ``AT+XACT=2,,,0`` - 4G

Команды в терминале:

lte1:

* ``interface lte at-chat lte1 wait=yes input="AT+XREG?"`` - Посмотреть текущий режим работы модема (лте или 3г)
* ``interface lte at-chat lte1 wait=yes input="AT+XACT?"`` - Посмотреть текущие бенды модема

ppp-out1:

Сперва вводим

    system script job remove [find script=PPPSignal]
    
    system serial-terminal port=usb1 channel=2

Затем пишем команду и нажимаем Enter:

* ``AT+XREG?`` - Посмотреть текущий режим работы модема (лте или 3г)
* ``AT+XACT?`` - Посмотреть текущие бенды модема
